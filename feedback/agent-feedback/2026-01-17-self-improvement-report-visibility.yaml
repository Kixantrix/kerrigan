agent: kerrigan
date: 2026-01-17
severity: medium
category: process-gap
context:
  task: "Review daily self-improvement workflow outputs"
  related_files:
    - .github/workflows/daily-self-improvement.yml
    - tools/self_improvement_analyzer.py
  related_issues:
    - 89
    - 90
    - 91

observation: |
  The daily self-improvement workflow successfully runs at 2 AM UTC and produces
  valuable analysis artifacts, but these artifacts are not accessible in the repository:
  
  **What the workflow produces:**
  1. `self-improvement-report.md` - Full analysis report with findings and recommendations
  2. `analysis-results.json` - Structured data with metrics and proposals
  3. GitHub issues for high/medium priority proposals (automatic)
  
  **Current state:**
  - Reports uploaded as GitHub Actions artifacts (30-day retention)
  - Not committed to repository
  - Not visible in project structure
  - Must download artifact ZIP from Actions UI to view
  
  **Workflow created 3 issues from today's run:**
  - Issue #89: Fix PowerShell 5.1 Unicode parsing
  - Issue #90: Expand agent tooling capabilities
  - Issue #91: Improve triage agent prompt and guidelines
  
  But the full analysis report that generated these issues is not accessible
  without navigating to GitHub Actions â†’ Workflow Runs â†’ Download Artifact.

pattern: |
  **Self-improvement loop visibility gap:**
  
  ```
  Feedback created â†’ Daily workflow runs â†’ Analysis generated â†’ Issues created
                                              â†“
                                    [HIDDEN IN ARTIFACTS]
                                              â†“
                              Report not in repo structure
  ```
  
  **Missing from project structure:**
  
  ```
  feedback/
    agent-feedback/           # âœ… Input visible
      2026-01-17-*.yaml       # âœ… 8 feedback files today
    processed/                # âŒ No processed files
    analysis-reports/         # âŒ Does not exist
      2026-01-18-report.md    # âŒ Report hidden in artifacts
      2026-01-18-results.json # âŒ Data hidden in artifacts
  ```
  
  **What should happen:**
  
  1. **Commit reports to repository:**
     - Create `feedback/analysis-reports/` directory
     - Store each day's report: `YYYY-MM-DD-analysis.md`
     - Store each day's JSON: `YYYY-MM-DD-results.json`
     - Commit with automated message
  
  2. **Archive processed feedback:**
     - Move analyzed feedback to `feedback/processed/YYYY-MM-DD/`
     - Keeps agent-feedback/ directory clean
     - Preserves feedback history
  
  3. **Update project structure:**
     - Add to workspace structure in docs
     - Make reports discoverable via README link
     - Track analysis trends over time

recommendation: |
  **For Kerrigan (system maintainer):**
  
  **Simpler approach: Create daily summary issue instead of committing reports**
  
  The workflow already creates individual issues for actionable proposals (high/medium priority).
  Instead of committing full reports, add ONE daily summary issue that links to artifacts.
  
  1. **Add daily summary issue creation to workflow:**
  
     Add after "Create improvement proposal issues" step:
     
     ```yaml
     - name: Create daily summary issue
       if: steps.analysis.outputs.feedback_count > 0
       uses: actions/github-script@v7
       with:
         script: |
           const fs = require('fs');
           const results = JSON.parse(fs.readFileSync('analysis-results.json', 'utf8'));
           const date = new Date().toISOString().split('T')[0];
           
           // Build issues created list from previous step
           const issuesCreated = results.proposals
             .filter(p => p.priority === 'high' || p.priority === 'medium')
             .map(p => `- ${p.title}`)
             .join('\n');
           
           const body = `## Self-Improvement Analysis for ${date}
           
           ### Metrics
           - **Feedback processed**: ${{ steps.analysis.outputs.feedback_count }}
           - **Patterns found**: ${{ steps.analysis.outputs.patterns_count }}
           - **Proposals generated**: ${{ steps.analysis.outputs.proposals_count }}
           - **High priority**: ${{ steps.analysis.outputs.high_priority }}
           
           ### Issues Created
           ${issuesCreated || 'No new issues created (low priority proposals only)'}
           
           ### Full Report
           ðŸ“Ž [Download full analysis report](https://github.com/${context.repo.owner}/${context.repo.repo}/actions/runs/${context.runId})
           
           The complete report with all proposals, evidence, and pattern analysis is available in the workflow artifacts (30-day retention).
           
           ---
           *Automated by daily-self-improvement workflow*`;
           
           await github.rest.issues.create({
             owner: context.repo.owner,
             repo: context.repo.repo,
             title: `[Daily Analysis] Self-Improvement Summary ${date}`,
             body: body,
             labels: ['kerrigan', 'meta', 'daily-summary']
           });
     ```
  
  2. **Create labels if they don't exist:**
  
     ```bash
     gh label create "meta" --description "Meta issues about the system itself" --color "000000"
     gh label create "daily-summary" --description "Daily self-improvement summaries" --color "0E8A16"
     ```
  
  3. **Allow manual trigger by Kerrigan:**
  
     The workflow already has `workflow_dispatch` trigger. Kerrigan can run:
     
     ```powershell
     gh workflow run daily-self-improvement.yml \
       --field since_days=1 \
       --field create_issues=true
     ```
  
  4. **Close old summary issues automatically (optional):**
  
     Add to summary issue creation:
     
     ```javascript
     // Close yesterday's summary issue to reduce noise
     const yesterday = new Date(Date.now() - 86400000).toISOString().split('T')[0];
     const oldIssues = await github.rest.issues.listForRepo({
       owner: context.repo.owner,
       repo: context.repo.repo,
       state: 'open',
       labels: 'daily-summary',
       per_page: 100
     });
     
     for (const issue of oldIssues.data) {
       if (issue.title.includes(yesterday)) {
         await github.rest.issues.update({
           owner: context.repo.owner,
           repo: context.repo.repo,
           issue_number: issue.number,
           state: 'closed',
           state_reason: 'completed'
         });
       }
     }
     ```
  
  **Benefits of this approach:**
  
  - âœ… No duplicate storage (artifacts + issues instead of artifacts + issues + commits)
  - âœ… Summary issue provides visibility and metrics
  - âœ… Full report still accessible via artifact link
  - âœ… Individual actionable issues created automatically
  - âœ… No extra repository commits needed
  - âœ… Kerrigan can trigger manually when needed
  - âœ… Simpler implementation (no git configuration needed)
  - âœ… Old summaries can be auto-closed to reduce noise

evidence: |
  **Latest workflow run (2026-01-18 03:47 UTC):**
  
  Analysis successful:
  - Feedback processed: 6 items
  - Patterns found: 1
  - Proposals generated: 4
  - High priority: 1
  - Issues created: 3 (#89, #90, #91)
  
  **Artifacts produced:**
  - self-improvement-report.md (4.8 KB)
  - analysis-results.json
  - Uploaded to Actions artifacts (ID: 5166886638)
  - Retention: 30 days
  
  **Visibility problem:**
  - Cannot access report without:
    1. Navigate to Actions tab
    2. Find "Daily Self-Improvement Analysis #2"
    3. Scroll to artifacts section
    4. Download self-improvement-report.zip
    5. Extract and read
  
  - Not discoverable from repository browser
  - Not linkable in issues/comments
  - Lost after 30 days
  
  **Current workflow excerpt:**
  ```yaml
  - name: Upload analysis report
    uses: actions/upload-artifact@v4
    with:
      name: self-improvement-report
      path: |
        self-improvement-report.md
        analysis-results.json
      retention-days: 30
  ```
  
  **What's missing:** No step to commit these files back to the repository.
  
  **Comparison to other systems:**
  - CI artifacts: Temporary build outputs (appropriate for artifacts)
  - Analysis reports: Historical documentation (should be in repo)
  - Similar to how test reports or coverage reports should be committed
  
  **Git history would show:**
  ```
  commit abc123
  Author: kerrigan-bot
  Date: 2026-01-18
  
  Add self-improvement analysis report for 2026-01-18
  
  - Feedback processed: 6
  - Patterns found: 1
  - Proposals generated: 4
  - Issues created: 3
  
  [In diff: new files in feedback/analysis-reports/]
  ```

impact: medium
actionable: true
