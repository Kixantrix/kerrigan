# Agent Feedback - Quality Bar Label Override Not Implemented

# REQUIRED FIELDS
timestamp: "2026-01-17T08:00:00Z"
issue_number: 74
agent_role: "triage"
category: "tool_limitation"
severity: "medium"
title: "allow:large-file label exists but validator doesn't check it"

# REQUIRED: Detailed description
description: |
  The quality bar validator (check_quality_bar.py) documents support for 
  `allow:large-file` label override but doesn't actually implement GitHub 
  API checking, requiring admin bypass for legitimate large files.
  
  **What happened:**
  - PR #74 added 413 lines to self_improvement_analyzer.py (596→1009 LOC)
  - Growth justified: 4 research modules with safety validation
  - Applied `allow:large-file` label to override quality bar
  - CI still failed: "Files exceed maximum LOC threshold"
  - Required `--admin` flag merge instead of label override
  
  **Validator documentation says:**
  ```python
  # Override policy:
  # - In CI, label-based overrides require GitHub API; not implemented in this starter.
  #   For now, treat as hard thresholds; humans can adjust thresholds or ignore paths if needed.
  ```
  
  **Current behavior:**
  - 800 LOC limit is hard threshold
  - No label checking implemented
  - Only workarounds: admin bypass or split files
  
  **Impact:**
  - Cannot use documented override mechanism
  - Creates friction for legitimate large files (comprehensive modules, analyzers)
  - Forces choice between admin bypass (reduces protection) or premature refactoring
  - Label system gives false impression of working override

# OPTIONAL FIELDS
related_files:
  - "tools/validators/check_quality_bar.py"
  - "specs/kerrigan/030-quality-bar.md"

context: |
  PR #74 was the first case needing legitimate quality bar override.
  File grew from 596→1009 LOC adding 4 research modules:
  - GitHubAnalysisResearcher
  - WebSearchResearcher  
  - PaperResearcher
  - FrameworkAnalysisResearcher
  
  Created follow-up issue #75 for refactoring, but PR was time-sensitive
  (implements requested feature from issue #73).
  
  Used `gh pr edit 74 --add-label "allow:large-file"` but had no effect.
  Eventually merged with `--admin` flag after approval.

proposed_solution: |
  **Option 1: Implement label checking (recommended)**
  
  Update check_quality_bar.py to check PR labels via GitHub API:
  
  ```python
  import os
  import json
  from urllib.request import Request, urlopen
  
  def has_override_label(pr_number: int) -> bool:
      """Check if PR has allow:large-file label."""
      token = os.environ.get('GITHUB_TOKEN')
      if not token or not pr_number:
          return False
      
      repo = os.environ.get('GITHUB_REPOSITORY')
      url = f"https://api.github.com/repos/{repo}/pulls/{pr_number}"
      req = Request(url, headers={'Authorization': f'token {token}'})
      
      try:
          with urlopen(req) as response:
              data = json.loads(response.read())
              labels = [label['name'] for label in data.get('labels', [])]
              return 'allow:large-file' in labels
      except Exception:
          return False
  
  # In main validator logic:
  pr_number = os.environ.get('PR_NUMBER')  # Set in workflow
  if has_override_label(int(pr_number)):
      print("::warning::Quality bar override: allow:large-file label present")
      return  # Skip enforcement
  ```
  
  Update .github/workflows/ci.yml to pass PR number:
  ```yaml
  - name: Check quality bar
    env:
      PR_NUMBER: ${{ github.event.pull_request.number }}
    run: python tools/validators/check_quality_bar.py
  ```
  
  **Option 2: Document limitation clearly**
  
  If implementing label check is too complex, update documentation:
  
  1. Remove `allow:large-file` from docs/github-labels.md
  2. Update check_quality_bar.py comment to be explicit:
     "Label-based overrides NOT IMPLEMENTED. Use --admin flag for exceptions."
  3. Update playbooks/triage.md with admin bypass procedure
  
  **Option 3: Environment variable override**
  
  Simpler alternative to label checking:
  ```yaml
  - name: Check quality bar
    env:
      QUALITY_BAR_SKIP: ${{ contains(github.event.pull_request.labels.*.name, 'allow:large-file') }}
    run: python tools/validators/check_quality_bar.py
  ```
  
  Then check env var in Python:
  ```python
  if os.environ.get('QUALITY_BAR_SKIP') == 'true':
      print("::warning::Quality bar skipped (allow:large-file label)")
      sys.exit(0)
  ```

# METADATA (leave blank for new feedback)
status: "new"
reviewed_by: ""
reviewed_date: ""
implementation_pr: null
notes: ""
