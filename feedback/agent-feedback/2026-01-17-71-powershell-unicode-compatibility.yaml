# Agent Feedback - PowerShell 5.1 Unicode Compatibility

# REQUIRED FIELDS
timestamp: "2026-01-17T08:00:00Z"
issue_number: 71
agent_role: "triage"
category: "tool_limitation"
severity: "high"
title: "PowerShell 5.1 cannot parse Unicode emojis and box-drawing characters"

# REQUIRED: Detailed description
description: |
  During development of the triage-prs.ps1 script (PR #71), discovered that 
  PowerShell 5.1 (Windows PowerShell) fails to parse scripts containing Unicode 
  emoji characters (üü¢üî¥‚ö†Ô∏è‚è∏Ô∏èüìãüìù) and box-drawing characters (‚îÅ).
  
  **What happened:**
  - Script tested successfully on PowerShell 7.4.13
  - Copilot made 6 commit attempts to fix "string terminator missing" errors
  - All attempts failed because root cause (Unicode characters) wasn't identified
  - Parser errors pointed to wrong lines (closing braces after emoji sections)
  
  **Root cause:**
  - Multi-byte UTF-8 emojis break PowerShell 5.1 string parser
  - Box-drawing characters (‚îÅ) cause similar issues
  - PowerShell 5.1 still default on Windows (unlike PowerShell 7.x)
  
  **Impact:**
  - Blocked PR #71 for ~24 hours across 7 commits
  - Script looked correct but couldn't execute
  - Testing on wrong PowerShell version led to false confidence
  
  **Resolution:**
  - Replaced all Unicode emojis with ASCII alternatives: üü¢‚Üí[OK], üî¥‚Üí[!!], ‚ö†Ô∏è‚Üí[WARN]
  - Replaced box-drawing characters with standard equals signs: ‚îÅ‚Üí=
  - Script now works on both PowerShell 5.1 and 7.x

# OPTIONAL FIELDS
related_files:
  - "tools/triage-prs.ps1"
  - ".github/agents/role.triage.md"

related_artifacts:
  - "tools/triage-prs.ps1"

context: |
  PR #71 introduced the triage role and triage-prs.ps1 dashboard script.
  The script was developed and tested in PowerShell 7.x environment but 
  deployed to Windows PowerShell 5.1.
  
  The mismatch between development and target environment wasn't caught 
  until manual local testing after 6 failed automated fix attempts.
  
  Related commits in PR #71:
  - Commits 1-6: Various attempted fixes for string parsing
  - Commit 7: Final fix replacing Unicode with ASCII

proposed_solution: |
  **Short term:**
  1. Document PowerShell version requirements in script headers
  2. Add PSVersion check at script start with clear error message
  3. Prefer ASCII characters over Unicode for cross-version compatibility
  
  **Long term:**
  1. Add PowerShell version matrix testing to CI (5.1 + 7.x)
  2. Include PowerShell linting in CI to catch compatibility issues
  3. Create PowerShell style guide recommending ASCII over Unicode
  4. Consider PSScriptAnalyzer rules for compatibility checking
  
  **Template for version check:**
  ```powershell
  #Requires -Version 5.1
  if ($PSVersionTable.PSVersion.Major -lt 5) {
      Write-Error "This script requires PowerShell 5.1 or later"
      exit 1
  }
  ```
  
  **Style recommendation:**
  - Use ASCII art/characters for status indicators: [OK], [!!], [WARN]
  - Use standard ASCII box characters: =, -, |, +
  - Reserve Unicode for output only (Write-Host), not in string literals

# METADATA (leave blank for new feedback)
status: "implemented"
reviewed_by: "copilot"
reviewed_date: "2026-01-19"
implementation_pr: "copilot/fix-unicode-parsing-issues"
notes: |
  Short-term fixes implemented:
  - All PowerShell scripts updated with #Requires -Version 5.1
  - Version checks added to all scripts with clear error messages
  - All Unicode emojis replaced with ASCII alternatives
  - Comprehensive PowerShell style guide created (docs/powershell-style-guide.md)
  - tools/README.md updated with version requirements and troubleshooting
  
  Long-term recommendations documented for future implementation:
  - PowerShell matrix testing (5.1 + 7.x) in CI
  - PSScriptAnalyzer integration for linting
  - Automated Unicode character detection in CI
